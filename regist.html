<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- PC -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
  <meta name="description" content="">
  <!-- mobile -->
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0, shrink-to-fit=no">
  <title>title</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
          crossorigin="anonymous"></script>

  <!--====== Animate CSS ======-->
  <link rel="stylesheet" href="./common/css/animate.css">

  <!--====== Glide CSS ======-->
  <link rel="stylesheet" href="./common/css/tiny-slider.css">
  <!--====== Default CSS ======-->
  <link rel="stylesheet" href="./css/common.css">
  <link rel="stylesheet" href="./common/css/default.css">
  <link rel="stylesheet" href="./css/regist.css">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>
<body>
<section id="home" class="header_area">
  <div id="header_navbar" class="header_navbar">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <nav class="navbar navbar-expand-lg">
            <a class="navbar-brand" href="index.html">
              <img id="logo" src="./common/images/logo-white-trans-svg.svg" alt="logo">
            </a>
            <button id="navbar-toggler" class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
              <span class="toggler-icon"></span>
              <span class="toggler-icon"></span>
              <span class="toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse sub-menu-bar" id="navbarSupportedContent">
              <ul id="nav" class="navbar-nav ms-auto">
                <li class="nav-item">
                  <a class="page-scroll" href="#home">Home</a>
                </li>
                <li class="nav-item">
                  <a class="page-scroll" href="/common/index.html#features">About</a>
                </li>
                <li class="nav-item">
                  <a class="page-scroll" href="/common/index.html#gallery">Gallery</a>
                </li>
                <li class="nav-item">
                  <a class="page-scroll" href="/common/index.html#contact">Contact</a>
                </li>
              </ul>
            </div> <!--navbar collapse-->
          </nav> <!--navbar-->
        </div>
      </div> <!--row-->
    </div> <!--container -->
  </div> <!--header navbar-->
  <div id="liveAlertPlaceholder"></div>
  <div class="header_hero">
    <div class="single_hero bg_cover d-flex align-items-center"
         style="background-image: url(./common/images/hero-library.jpg)">
      <div class="container">
        <div class="row justify-content-center">
          <div class="hero_content">
            <form id="registerForm" action="">
              <h2>Register</h2>
              <div class="form-group mb-3">
                <label for="inputFirstName" class="col-form-label">First name</label>
                <input type="text" name="firstName" class="form-control" id="inputFirstName" placeholder="first name" required>
              </div>
              <div class="form-group mb-3">
                <label for="inputLastName" class="col-form-label">Last name</label>
                <input type="text" name="lastName" class="form-control" id="inputLastName" placeholder="last name" required>
              </div>
              <div class="form-group mb-3">
                <label for="inputEmail" class="col-form-label">Email</label>
                <input type="email" name="email" class="form-control" id="inputEmail" placeholder="email" required>
                <div id="emailInvalidFeedback" class="invalid-feedback">
                  Email is not valid.
                </div>
                <div id="emailValidFeedBack" class="valid-feedback">Looks good!</div>
              </div>
              <div class="form-group mb-3">
                <label for="inputPassword" class="col-form-label">Password</label>
                <input type="password" name="password" id="inputPassword" class="form-control"
                       aria-describedby="passwordHelpBlock" placeholder="password" required>
                <small id="passwordHelpBlock" class="form-text text-muted">
                  <ul>
                    <li>8 to 15 characters in length</li>
                    <li>At least one uppercase and one lowercase letter</li>
                    <li>At least one number</li>
                    <li>At least one special character, e.g. ! @ # ?</li>
                  </ul>
                </small>
              </div>
              <div class="form-group mb-3">
                <label for="repeatPass" class="col-form-label">Confirm password</label>
                <input type="password" name="password" id="repeatPass" class="form-control"
                       aria-describedby="passwordHelpBlock" placeholder="confirm your password" disabled required>
              </div>
              <div class="form-group mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="agreementCheck" required>
                  <label class="form-check-label" for="agreementCheck" style="color: snow">
                    Agree to <a href="#">terms and conditions</a>
                  </label>
                </div>
              </div>

              <button id="submit" type="submit" class="btn btn-primary">Register</button>
              <button id="dummyBtn" class="btn btn-primary" type="button" disabled hidden>
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                Registering...
              </button>

            </form>
          </div>
        </div>
      </div>
    </div> <!--single hero-->
  </div><!-- header hero-->

</section>

<section id="footer" class="footer_area">
  <div class="container">
    <div class="footer_wrapper text-center d-lg-flex align-items-center justify-content-between">
      <p class="credit">Designed and Developed by <a href="#" rel="nofollow">R.Q</a></p>
      <div class="footer_social pt-15">
        <ul>
          <li><a href="#"><i class="lni lni-facebook-original"></i></a></li>
          <li><a href="#"><i class="lni lni-twitter-original"></i></a></li>
          <li><a href="#"><i class="lni lni-instagram-original"></i></a></li>
          <li><a href="#"><i class="lni lni-linkedin-original"></i></a></li>
        </ul>
      </div> <!-- footer social -->
    </div> <!-- footer wrapper -->
  </div> <!-- container -->
</section>

<script src=""></script>
<script>
  const inputFirstName = document.getElementById("inputFirstName")
  const inputLastName = document.getElementById("inputLastName")
  const inputEmail = document.getElementById("inputEmail")
  const inputPassword = document.getElementById("inputPassword")
  const inputAgreementCheck = document.getElementById("agreementCheck")
  const registerForm = document.getElementById("registerForm")
  const emailInvalidFeedBack = document.getElementById("emailInvalidFeedback")
  const confirmPass = document.getElementById("repeatPass")

  const alertPlaceholder = document.getElementById('liveAlertPlaceholder')



  // const emailReg = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/
  const emailReg = /^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,})$/
  const nameReg = /^[\w'\-,.][^0-9_!¡?÷?¿/\\+=@#$%ˆ&*(){}|~<>;:[\]]{0,19}$/
  const passwordReg = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*?&])[A-Za-z\d$@$!%*?&]{8,15}/

  confirmPass.addEventListener("change", e => {
    if (confirmPass.value.trim() === inputPassword.value.trim() && inputPassword.classList.contains("is-valid")) {
      changeInputStatus(e.target, "is-valid")
    } else {
      changeInputStatus(e.target, "is-invalid")
    }
  })


  inputPassword.addEventListener("change", e => {
    checkField(e, passwordReg, 15)
    if (inputPassword.classList.contains("is-valid")) {
      confirmPass.removeAttribute("disabled")
    } else {
      confirmPass.setAttribute("disabled", "true")
    }
  })
  inputEmail.addEventListener("change", e => {
    if (checkField(e, emailReg, 50)) {
      checkEmailDup(e)
    }
  })
  inputFirstName.addEventListener("change", (e) => {
    checkField(e, nameReg, 20)
  })
  inputLastName.addEventListener("change", (e) => {
    checkField(e, nameReg, 20)
  })
  inputAgreementCheck.addEventListener("change", (e) => {
    checkAgreement(e)
  })

  const checkEmailDup = (e) => {
    const ele = e.target
    const email = e.target.value
    axios.get('./php/emailDupCheck.php?email=' + email)
      .then((response) => {
        if (response.data.code === "0") {
          changeInputStatus(ele, "is-valid")

        } else {
          changeInputStatus(ele, "is-invalid")
          emailInvalidFeedBack.innerHTML = response.data.message;
        }
      })
      .catch((error) => {
        changeInputStatus(ele, "is-invalid")
        emailInvalidFeedBack.innerHTML = error;
      })
  }

  const checkField = (e, reg, len) => {
    const ele = e.target
    if (ele.value.trim().length === ele.value.length && ele.value.length <= len && reg.test(ele.value)) {
      changeInputStatus(ele, "is-valid")
      return true
    } else {
      changeInputStatus(ele, "is-invalid")
      return false
    }
  }

  function changeInputStatus(ele, statu) {
    switch (statu) {
      case "is-valid":
        if (!ele.classList.contains("is-valid")) {
          if (ele.classList.contains("is-invalid")) {
            ele.classList.remove("is-invalid")
          }
          ele.classList.add("is-valid")
        }
        break;
      case "is-invalid":
        if (!ele.classList.contains("is-invalid")) {
          if (ele.classList.contains("is-valid")) {
            ele.classList.remove("is-valid")
          }
          ele.classList.add("is-invalid")
        }
        break;
      default:
        break;
    }
  }


  const checkAgreement = (e) => {
    const ele = e.target
    if (ele.checked) {
      changeInputStatus(ele, "is-valid")
    } else {
      changeInputStatus(ele, "is-invalid")
    }
  }
  const toggleInputsAndBtn = (dest) => {
    const inputs = document.getElementsByTagName("input")
    const btn = document.getElementById("submit")
    const dummyBtn = document.getElementById("dummyBtn")
    if (dest === "disabled") {
      for(let i = 0; i < inputs.length; i++) {
        inputs[i].setAttribute("disabled", "true")
      }
      btn.setAttribute("hidden", "true")
      dummyBtn.removeAttribute("hidden")
    } else {
      for(let i = 0; i < inputs.length; i++) {
        inputs[i].removeAttribute("disabled")
      }
      btn.removeAttribute("hidden")
      dummyBtn.setAttribute("hidden", "true")
    }
  }

  const alert = (message, type) => {
    const wrapper = document.createElement('div')
    wrapper.innerHTML = [
      `<div class="alert alert-${type} alert-dismissible" role="alert">`,
      `   <div>${message}</div>`,
      '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
      '</div>'
    ].join('')
    alertPlaceholder.append(wrapper)
  }


  registerForm.addEventListener("submit", (e) => {
    e.preventDefault()
    e.stopPropagation()
    const elements = document.getElementsByClassName("is-valid")
    if (elements.length === 6) {
      toggleInputsAndBtn("disabled")
      const firstName = inputFirstName.value.trim()
      const lastName = inputLastName.value.trim()
      const email = inputEmail.value.trim().toLowerCase()
      const password = inputPassword.value.trim()
      axios({
        url: './php/register.php',
        method: 'POST',
        data: {
          firstName,
          lastName,
          email,
          password
        }
      }).then(response => {
        if (response.data.code === "0") {
          registerForm.reset()
          toggleInputsAndBtn('able')
          alert("Congratulations, Register successfully, will redirect to home page in 3 seconds", 'success')
          setTimeout(() => {
            location.href='./login.html'
          },3000)
        } else {
          toggleInputsAndBtn("able")
          alert(response.data.message+" please try again later", "danger")
        }
      }).catch(error => {
        toggleInputsAndBtn("able")
        alert(error.message + "please try again later", "danger")
      })
    }


  })


</script>
</body>
</html>
